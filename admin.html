<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GEPT AI å‡ºé¡Œç¥å™¨ âš¡</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-dark: #0f172a;
      --bg-card: #1e293b;
      --accent: #00e0ff;
      --text-main: #f1f5f9;
      --text-muted: #94a3b8;
      --border: #334155;
    }

    * { box-sizing: border-box; }

    body {
      font-family: "Poppins", "Segoe UI", sans-serif;
      background: var(--bg-dark);
      color: var(--text-main);
      margin: 0;
      padding: 20px;
      line-height: 1.6;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
    }

    h1 {
      text-align: center;
      color: var(--accent);
      font-size: 2em;
      margin-bottom: 10px;
    }

    .subtitle {
      text-align: center;
      color: var(--text-muted);
      margin-bottom: 30px;
      font-size: 0.9em;
    }

    .card {
      background: var(--bg-card);
      border-radius: 16px;
      padding: 24px;
      border: 1px solid var(--border);
      box-shadow: 0 10px 25px rgba(0,0,0,0.3);
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--accent);
    }

    input[type="password"], 
    textarea {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: #0f172a;
      color: white;
      font-family: inherit;
      font-size: 1em;
      margin-bottom: 16px;
    }
    
    textarea {
      min-height: 120px;
      resize: vertical;
    }

    .btn {
      background: linear-gradient(135deg, #00e0ff, #00ff9d);
      color: #0f172a;
      border: none;
      padding: 12px 24px;
      border-radius: 999px;
      font-weight: 700;
      cursor: pointer;
      font-size: 1em;
      transition: transform 0.2s, filter 0.2s;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn:hover {
      transform: translateY(-2px);
      filter: brightness(1.1);
    }

    .btn:disabled {
      background: #475569;
      color: #94a3b8;
      cursor: not-allowed;
      transform: none;
    }

    .preview-list {
      list-style: none;
      padding: 0;
    }

    .preview-item {
      background: rgba(0,0,0,0.2);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 12px;
      display: grid;
      grid-template-columns: 100px 1fr;
      gap: 16px;
      align-items: start;
    }

    .preview-item label {
      font-size: 0.8em;
      color: var(--text-muted);
      margin-bottom: 2px;
    }

    .field-group {
      margin-bottom: 8px;
    }
    
    .preview-input {
      width: 100%;
      background: transparent;
      border: 1px solid #334155;
      color: #e2e8f0;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.9em;
    }

    .tag {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 4px;
      background: #334155;
      font-size: 0.8em;
      margin-right: 4px;
    }

    #loading {
      display: none;
      text-align: center;
      padding: 20px;
      color: var(--accent);
    }

    .spinner {
      width: 24px;
      height: 24px;
      border: 3px solid rgba(0, 224, 255, 0.3);
      border-top-color: #00e0ff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      display: inline-block;
      vertical-align: middle;
      margin-right: 10px;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    .api-help {
      font-size: 0.85em;
      color: var(--text-muted);
      margin-top: -10px;
      margin-bottom: 20px;
    }
    .api-help a { color: var(--accent); }
  </style>
</head>
<body>

<div class="container">
  <h1>ğŸ¤– GEPT AI å‡ºé¡Œç¥å™¨</h1>
  <div class="subtitle">è¼¸å…¥å–®å­—ï¼ŒAI è‡ªå‹•å¹«ä½ ç”Ÿæˆä¾‹å¥ã€ä¸­æ–‡ã€èª˜ç­”é¸é …ï¼</div>

  <div class="card">
    <label for="apiKey">Step 1: è¼¸å…¥ä½ çš„ Gemini API Key</label>
    <input type="password" id="apiKey" placeholder="è²¼ä¸Šä½ çš„ API Key (ä¾‹å¦‚: AIzaSy...)" />
    <div class="api-help">
      é‚„æ²’æœ‰ Keyï¼Ÿåˆ° <a href="https://aistudio.google.com/app/apikey" target="_blank">Google AI Studio</a> å…è²»ç²å–ã€‚
      (ä½ çš„ Key åªæœƒå„²å­˜åœ¨ä½ çš„ç€è¦½å™¨ä¸­ï¼Œä¸æœƒä¸Šå‚³)
    </div>

    <label for="wordList">Step 2: è¼¸å…¥å–®å­—åˆ—è¡¨ (ä¸€è¡Œä¸€å€‹)</label>
    <textarea id="wordList" placeholder="apple&#10;banana&#10;computer&#10;dinosaur"></textarea>

    <button id="generateBtn" class="btn" onclick="generateContent()">
      âœ¨ é–‹å§‹ç”Ÿæˆé¡Œç›®
    </button>
  </div>

  <div id="loading">
    <div class="spinner"></div> æ­£åœ¨å‘¼å« AI å¤§è…¦ï¼Œè«‹ç¨å€™...
  </div>

  <div id="resultArea" class="card" style="display:none;">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
      <label style="margin:0;">Step 3: é è¦½èˆ‡ç·¨è¼¯ (å¯ç›´æ¥ä¿®æ”¹å…§å®¹)</label>
      <button class="btn" onclick="downloadJSON()">ğŸ“¥ ä¸‹è¼‰ JSON æª”æ¡ˆ</button>
    </div>
    <div id="previewContainer"></div>
  </div>
</div>

<script>
  let generatedData = [];

  async function generateContent() {
    const apiKey = document.getElementById('apiKey').value.trim();
    const words = document.getElementById('wordList').value.trim();

    if (!apiKey) {
      alert("è«‹è¼¸å…¥ API Keyï¼");
      return;
    }
    if (!words) {
      alert("è«‹è¼¸å…¥å–®å­—ï¼");
      return;
    }

    // UI åˆ‡æ›
    document.getElementById('generateBtn').disabled = true;
    document.getElementById('loading').style.display = 'block';
    document.getElementById('resultArea').style.display = 'none';

    const wordList = words.split('\n').filter(w => w.trim() !== '').join(', ');

    // é€™æ˜¯çµ¦ AI çš„å’’èª (Prompt)
    const prompt = `
      Act as an expert English teacher for GEPT Elementary (å…¨æ°‘è‹±æª¢åˆç´š) students in Taiwan.
      I will provide a list of vocabulary words. 
      Please generate a JSON array containing objects for each word with the following fields:
      
      1. "Vocabulary": The word itself.
      2. "Chinese": The Traditional Chinese definition (short and common).
      3. "sentence": A simple English sentence using the word, but replace the target word with "________". The sentence level should be A2 (Elementary).
      4. "answer": The target word.
      5. "distractors": An array of 3 English words that are the same part of speech but wrong meanings (distractors).
      6. "chinese_sentence": The Traditional Chinese translation of the English sentence.

      The output must be strictly valid JSON array format. Do not include markdown formatting (like \`\`\`json).

      Words to process: ${wordList}
    `;

    try {
      const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          contents: [{ parts: [{ text: prompt }] }]
        })
      });

      const data = await response.json();
      
      if (data.error) {
        throw new Error(data.error.message);
      }

      let rawText = data.candidates[0].content.parts[0].text;
      
      // æ¸…ç†å¯èƒ½çš„å›æ‡‰æ ¼å¼ (å»é™¤ markdown æ¨™ç±¤)
      rawText = rawText.replace(/```json/g, '').replace(/```/g, '').trim();
      
      generatedData = JSON.parse(rawText);
      renderPreview();

      document.getElementById('resultArea').style.display = 'block';

    } catch (error) {
      console.error(error);
      alert("ç”Ÿæˆå¤±æ•—ï¼š" + error.message);
    } finally {
      document.getElementById('generateBtn').disabled = false;
      document.getElementById('loading').style.display = 'none';
    }
  }

  function renderPreview() {
    const container = document.getElementById('previewContainer');
    container.innerHTML = '';

    generatedData.forEach((item, index) => {
      const div = document.createElement('div');
      div.className = 'preview-item';
      div.innerHTML = `
        <div style="font-weight:bold; font-size:1.2em; color:#00e0ff;">
          ${index + 1}. ${item.Vocabulary}
        </div>
        <div style="width: 100%;">
          <div class="field-group">
            <label>ä¸­æ–‡å®šç¾© (Chinese)</label>
            <input class="preview-input" value="${item.Chinese}" onchange="updateData(${index}, 'Chinese', this.value)">
          </div>
          <div class="field-group">
            <label>ä¾‹å¥ (Sentence)</label>
            <input class="preview-input" value="${item.sentence}" onchange="updateData(${index}, 'sentence', this.value)">
          </div>
          <div class="field-group">
            <label>ä¾‹å¥ç¿»è­¯ (Translation)</label>
            <input class="preview-input" value="${item.chinese_sentence}" onchange="updateData(${index}, 'chinese_sentence', this.value)">
          </div>
          <div class="field-group">
            <label>èª˜ç­”é¸é … (Distractors - ç”¨é€—è™Ÿåˆ†éš”)</label>
            <input class="preview-input" value="${item.distractors.join(', ')}" onchange="updateDistractors(${index}, this.value)">
          </div>
        </div>
      `;
      container.appendChild(div);
    });
  }

  function updateData(index, field, value) {
    generatedData[index][field] = value;
  }

  function updateDistractors(index, value) {
    generatedData[index].distractors = value.split(',').map(s => s.trim());
  }

  function downloadJSON() {
    // ç¢ºä¿è³‡æ–™çµæ§‹å®Œæ•´ï¼Œå°‡ Vocabulary å’Œ Answer åŒæ­¥
    const finalData = generatedData.map(item => ({
      Vocabulary: item.Vocabulary,
      Chinese: item.Chinese,
      sentence: item.sentence,
      answer: item.Vocabulary, // ç¢ºä¿ answer æ¬„ä½å­˜åœ¨
      distractors: item.distractors,
      chinese: item.chinese_sentence // é…åˆéŠæˆ²è®€å– 'chinese' æ¬„ä½ (å¦‚æœæœ‰ç”¨åˆ°)
    }));

    const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(finalData, null, 2));
    const downloadAnchorNode = document.createElement('a');
    downloadAnchorNode.setAttribute("href", dataStr);
    
    // è‡ªå‹•ç”¢ç”Ÿæª”åï¼šdataset_æ—¥æœŸ_æ™‚é–“.json
    const now = new Date();
    const timestamp = `${now.getMonth()+1}${now.getDate()}_${now.getHours()}${now.getMinutes()}`;
    downloadAnchorNode.setAttribute("download", `GEPT_Dataset_${timestamp}.json`);
    
    document.body.appendChild(downloadAnchorNode);
    downloadAnchorNode.click();
    downloadAnchorNode.remove();
  }

  // è‡ªå‹•å„²å­˜/è®€å– API Key (æ–¹ä¾¿ä¸‹æ¬¡ä½¿ç”¨)
  const savedKey = localStorage.getItem('gemini_api_key');
  if (savedKey) document.getElementById('apiKey').value = savedKey;

  document.getElementById('apiKey').addEventListener('change', (e) => {
    localStorage.setItem('gemini_api_key', e.target.value);
  });
</script>

</body>
</html>
```

### ğŸŒŸ é€™å€‹ç”¢ç”Ÿå™¨ç”¢å‡ºçš„ JSON æ ¼å¼èªªæ˜

é€™å€‹ç”¢ç”Ÿå™¨ç”¢å‡ºçš„æª”æ¡ˆæ˜¯ã€Œ**å…¨åŠŸèƒ½é€šç”¨ç‰ˆ**ã€ã€‚å®ƒçš„ä¸€å€‹ç‰©ä»¶é•·é€™æ¨£ï¼š

```json
{
  "Vocabulary": "apple",           // çµ¦å–®å­—éŠæˆ²ç”¨
  "Chinese": "è˜‹æœ",               // çµ¦å–®å­—éŠæˆ²ç”¨
  "sentence": "I ate an ________.", // çµ¦é€ å¥éŠæˆ² & å–®å­—å¡ç”¨
  "answer": "apple",               // çµ¦é€ å¥éŠæˆ²ç”¨
  "distractors": ["car", "dog"],   // çµ¦éŠæˆ²é¸æ“‡é¡Œç”¨
  "chinese": "æˆ‘åƒäº†ä¸€é¡†è˜‹æœã€‚"      // çµ¦é€ å¥éŠæˆ²çš„ç¿»è­¯é¡¯ç¤º & å–®å­—å¡ç”¨
}
