<!DOCTYPE html>
<html lang="en">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
Â  <title>GEPT è©å½™å¤§æŒ‘æˆ°</title>
Â  Â  <link rel="preconnect" href="https://fonts.googleapis.com">
Â  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
Â  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
Â Â 
Â  <style>
Â  Â  :root {
Â  Â  Â  --correct-color: #28a745; /* æ›´é®®è±”çš„ç¶ è‰² */
Â  Â  Â  --incorrect-color: #dc3545; /* æ›´é®®è±”çš„ç´…è‰² */
Â  Â  Â  --main-blue: #007bff;
Â  Â  Â  --light-gray: #f8f9fa;
Â  Â  Â  --dark-text: #2c3e50;
Â  Â  }

Â  Â  body {
Â  Â  Â  /* ä½¿ç”¨æ›´æœ‰æ´»åŠ›çš„å­—é«” */
Â  Â  Â  font-family: 'Nunito', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
Â  Â  Â  max-width: 700px;
Â  Â  Â  margin: 40px auto;
Â  Â  Â  padding: 20px;
Â  Â  Â  /* æ›´æœ‰å±¤æ¬¡æ„Ÿçš„æ¼¸å±¤èƒŒæ™¯ */
Â  Â  Â  background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
Â  Â  Â  color: #333;
Â  Â  Â  transition: all 0.3s ease; /* ç‚ºäº†éœ‡å‹•æ•ˆæœ */
Â  Â  }
Â  Â Â 
Â  Â  /* ç­”éŒ¯æ™‚çš„éœ‡å‹•æ•ˆæœ */
Â  Â  @keyframes shake {
Â  Â  Â  10%, 90% { transform: translate3d(-1px, 0, 0); }
Â  Â  Â  20%, 80% { transform: translate3d(2px, 0, 0); }
Â  Â  Â  30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
Â  Â  Â  40%, 60% { transform: translate3d(4px, 0, 0); }
Â  Â  }
Â  Â  .shake-it {
Â  Â  Â  animation: shake 0.82s cubic-bezier(.36,.07,.19,.97) both;
Â  Â  }

Â  Â  h1 {
Â  Â  Â  text-align: center;
Â  Â  Â  color: var(--dark-text);
Â  Â  Â  font-size: 2.2em;
Â  Â  Â  font-weight: 800; /* æ›´ç²—çš„æ¨™é¡Œ */
Â  Â  }
Â  Â  h2 {
Â  Â  Â  color: var(--dark-text);
Â  Â  Â  font-weight: 700;
Â  Â  }

Â  Â  .progress-container {
Â  Â  Â  height: 18px; /* ç¨å¾®åŠ é«˜ */
Â  Â  Â  background: #e9ecef; /* æŸ”å’Œçš„åº•è‰² */
Â  Â  Â  border-radius: 10px;
Â  Â  Â  margin: 20px 0;
Â  Â  Â  overflow: hidden;
Â  Â  Â  box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
Â  Â  }
Â  Â  .progress-bar {
Â  Â  Â  height: 100%;
Â  Â  Â  width: 0%;
Â  Â  Â  background: linear-gradient(to right, #00c6ff, #0072ff);
Â  Â  Â  transition: width 0.3s ease-in-out;
Â  Â  Â  border-radius: 10px 0 0 10px;
Â  Â  }
Â  Â  Â .question {
Â  Â  Â  Â font-size: 1.6em; /* æ”¾å¤§é¡Œç›® */
Â  Â  Â  Â margin: 1.2em 0 1.5em 0;
Â  Â  Â  Â text-align: center;
Â  Â  Â  Â font-weight: 700;
Â  Â  Â  Â color: var(--dark-text);
Â  Â  }

Â  Â  .options {
Â  Â  Â  display: grid;
Â  Â  Â  grid-template-columns: 1fr 1fr;
Â  Â  Â  gap: 20px; /* å¢åŠ é–“è· */
Â  Â  }
Â  Â Â 
Â  Â  /* éŠæˆ²åŒ–çš„æŒ‰éˆ•é¢¨æ ¼ */
Â  Â  .options button {
Â  Â  Â  padding: 18px;
Â  Â  Â  font-size: 1.15em;
Â  Â  Â  font-weight: 700;
Â  Â  Â  border: none;
Â  Â  Â  border-radius: 12px;
Â  Â  Â  background: #ffffff;
Â  Â  Â  color: #444;
Â  Â  Â  /* é—œéµçš„ 3D æŒ‰éˆ•é™°å½± */
Â  Â  Â  border-bottom: 5px solid #ccc;
Â  Â  Â  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
Â  Â  Â  transition: all 0.15s ease-in-out;
Â  Â  Â  cursor: pointer;
Â  Â  }
Â  Â  .options button:hover:not(:disabled) {
Â  Â  Â  /* æ»‘é¼ æ‡¸åœæ™‚æ”¾å¤§ */
Â  Â  Â  transform: scale(1.03);
Â  Â  Â  background: #fff;
_Â  }
Â  Â  .options button:active:not(:disabled) {
Â  Â  Â  /* é»æ“Šæ™‚ã€ŒæŒ‰ä¸‹å»ã€çš„æ•ˆæœ */
Â  Â  Â  transform: translateY(3px);
Â  Â  Â  border-bottom-width: 2px;
Â  Â  Â  box-shadow: 0 2px 5px rgba(0,0,0,0.15);
Â  Â  }
Â  Â  .options button:disabled {
Â  Â  Â  cursor: not-allowed;
Â  Â  Â  opacity: 0.9;
Â  Â  }

Â  Â  /* æ­£ç¢ºæŒ‰éˆ•ï¼šæ›´äº®çš„ç¶ è‰² + ç™¼å…‰æ•ˆæœ */
Â  Â  .options button.correct {
Â  Â  Â  background: var(--correct-color);
Â  Â  Â  color: white;
Â  Â  Â  border-color: #218838;
Â  Â  Â  box-shadow: 0 0 15px 5px rgba(40, 167, 69, 0.5); /* ç™¼å…‰ */
Â  Â  }
Â  Â  /* éŒ¯èª¤æŒ‰éˆ•ï¼šæ›´äº®çš„ç´…è‰² */
Â  Â  .options button.incorrect {
Â  Â  Â  background: var(--incorrect-color);
Â  Â  Â  color: white;
Â  Â  Â  border-color: #c82333;
Â  Â  }
Â  Â Â 
Â  Â  .result-log {
Â  Â  Â  margin-top: 30px;
Â  Â  }
Â  Â  .result-log li {
Â  Â  Â  margin: 5px 0;
Â  Â  Â  font-size: 0.95em;
Â  Â  }
Â  Â  .score-display {
Â  Â  Â  text-align: center;
Â  Â  Â  font-size: 1.3em;
Â  Â  Â  margin: 10px 0;
Â  Â  Â  color: var(--dark-text);
Â  Â  Â  font-weight: 700;
Â  Â  }
Â  Â  /* æ”¾å¤§ç”Ÿå‘½å€¼ï¼Œæ›´é†’ç›® */
Â  Â  .lives-display {
Â  Â  Â  text-align: center;
Â  Â  Â  font-size: 1.8em; /* æ”¾å¤§ï¼ */
Â  Â  Â  margin: 10px 0;
Â  Â  Â  color: #e63946;
Â  Â  }
Â  Â  .leaderboard {
Â  Â  Â  margin-top: 30px;
Â  Â  Â  padding: 20px;
Â  Â  Â  background: var(--light-gray);
Â  Â  Â  border-radius: 10px;
Â  Â  }
Â  Â  .leaderboard h2 {
Â  Â  Â  text-align: center;
Â  Â  Â  font-size: 1.6em;
Â  Â  }
Â  Â  .leaderboard ul {
Â  Â  Â  list-style: none;
Â  Â  Â  padding: 0;
Â  Â  }
Â  Â  .leaderboard li {
Â  Â  Â  display: flex;
Â  Â  Â  justify-content: space-between;
Â  Â  Â  padding: 10px;
Â  Â  Â  border-bottom: 1px solid #ddd;
Â  Â  Â  font-size: 1em;
Â  Â  Â  font-weight: 600;
Â  Â  }
Â  Â  .badges {
Â  Â  Â  margin-top: 20px;
Â  Â  Â  text-align: center;
Â  Â  }
Â  Â  .badges span {
Â  Â  Â  display: inline-block;
Â  Â  Â  padding: 8px 16px;
Â  Â  Â  margin: 5px;
Â  Â  Â  background: #ffd700; /* é‡‘è‰²å¾½ç«  */
Â  Â  Â  color: #333;
Â  Â  Â  border-radius: 20px;
Â  Â  Â  font-size: 0.9em;
Â  Â  Â  font-weight: 700;
Â  Â  Â  box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
Â  Â  }
Â  </style>
</head>
<body>
Â  Â  <h1>GEPT ğŸš€ å–®å­—å¤§æŒ‘æˆ°</h1>
Â Â 
Â  <div style="text-align: center; margin-top: 10px;">
Â  Â  <label for="dataset">é¡Œåº«é¸æ“‡ï¼š</label>
Â  <select id="dataset" style="padding: 6px 10px; font-size: 1em;">
Â  Â  <option value="GEPT_20251109.json" data-limit="all">ğŸŒ GEPT ç¬¬ä¸‰å›+ç¬¬å››å›</option>
Â  Â  <option value="week1.json" data-limit="all">ğŸŸ¡ Week 1 (ä¸»é¡Œèª²æ–‡25é¡Œ)</option>
Â  Â  <option value="week2.json" data-limit="all">ğŸŸ¡ Week 2 (ä¸»é¡Œèª²æ–‡30é¡Œ)</option>
Â  Â  <option value="week2-bonus.json" data-limit="25">âœ¨ Week 2 (æ“´å……æŒ‘æˆ°25/50)</option>
Â  Â  <option value="GEPT_Stage3.json" data-limit="50">ğŸ¤© æ“´å……æŒ‘æˆ°Lv.3 (50/50)</option>
Â  Â  <option value="GEPT_Week3_Vocab.json" data-limit="all">ğŸ¤© æ“´å……æŒ‘æˆ°Lv.3</option>
Â  Â  <option value="gept-full.json" data-limit="25">ğŸ”µ å…¨ GEPT (éš¨æ©ŸæŒ‘æˆ°25/2256)</option>
Â  Â  <option value="gept-full.json" data-limit="all">ğŸ”µ å…¨ GEPT (é­”é¬¼æŒ‘æˆ°2256é¡Œ)</option>
Â  </select>Â  </div>
Â  <div style="text-align: center; margin-top: 20px;">
Â  Â  <label for="username">è«‹è¼¸å…¥ä½ çš„åå­—ï¼š</label>
Â  Â  <input id="username" type="text" placeholder="ä¾‹å¦‚ï¼šEmmett" style="padding: 8px 12px; font-size: 1em; border-radius: 8px; border: 1px solid #ccc; margin-top: 8px;" />
Â  Â  <button id="start-btn" onclick="startQuiz()" style="margin-left: 10px; padding: 8px 16px; font-size: 1em; border-radius: 8px; background-color: #007bff; color: white; border: none; cursor: pointer;">é–‹å§‹æŒ‘æˆ°</button>
Â  </div>

Â  <div class="progress-container" style="display:none;" id="progress-section">
Â  Â  <div class="progress-bar" id="progress-bar"></div>
Â  </div>
Â  <div class="quiz" style="display:none;">
Â  Â  <div class="score-display" id="score-display">ç›®å‰å¾—åˆ†ï¼š0</div>
Â  Â  <div class="lives-display" id="lives-display">å‰©é¤˜ç”Ÿå‘½ï¼šâ¤ï¸â¤ï¸â¤ï¸</div>
Â  Â  <div class="question" id="question"></div>
Â  Â  <div class="options" id="options"></div>
Â  Â  <h3 id="result-title" style="margin-top:30px;"></h3>
Â  Â  <ul class="result-log" id="results"></ul>
Â  Â  <div class="badges" id="badges"></div>
Â  </div>

Â  <div class="leaderboard" id="leaderboard">
Â  Â  <h2>ğŸ† ç©åˆ†æ’è¡Œæ¦œ</h2>
Â  Â  <ul id="leaderboard-list"></ul>
Â  </div>

Â  <script>
const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyg8OvuiCZbrtUTBy6a1pKyWeGUZJJbCJsxeodvwgbs9I2o6Fe7dS_irIntu44SNmJrig/exec"; 

// === ğŸš€ æ–°å¢éŸ³æ•ˆ ===
// è­¦å‘Šï¼šä»¥ä¸‹éŸ³æ•ˆé€£çµåƒ…ç‚ºç¯„ä¾‹ï¼Œå¯èƒ½éš¨æ™‚å¤±æ•ˆã€‚
// å»ºè­°ä½ è‡ªè¡Œä¸‹è¼‰ .mp3 éŸ³æ•ˆæª”ä¸¦ä¸Šå‚³åˆ°ä½ çš„ç©ºé–“ (ä¾‹å¦‚ GitHub æˆ–ä½ è‡ªå·±çš„ä¼ºæœå™¨)ã€‚
const soundClick = new Audio('https://pixabay.com/sound-effects/page-turn-102047.mp3'); 
const soundCorrect = new Audio('https://pixabay.com/sound-effects/correct-choice-43861.mp3'); 
const soundWrong = new Audio('https://pixabay.com/sound-effects/error-call-to-attention-129258.mp3'); 

// èª¿æ•´éŸ³é‡
soundClick.volume = 0.5;
soundCorrect.volume = 0.5;
soundWrong.volume = 0.5;
// === éŸ³æ•ˆçµæŸ ===


let selectedVoice = null;
let badgesEarned = JSON.parse(localStorage.getItem("badges")) || [];

function findEnglishVoice() {
Â  const voices = speechSynthesis.getVoices();
Â  const priority = ['Google US English', 'Samantha', 'Microsoft Aria Online (Natural) - English (United States)', 'Microsoft Zira', 'Microsoft David', 'Karen', 'Alex'];
Â  for (const name of priority) {
Â  Â  const match = voices.find(v => v.name.includes(name));
Â  Â  if (match) return match;
Â  }
Â  return voices.find(v => v.lang === 'en-US') || voices[0];
}

speechSynthesis.onvoiceschanged = () => {
Â  selectedVoice = findEnglishVoice();
};

let data = [
Â  { Vocabulary: "breathe fire", Chinese: "å™´ç«" },
Â  { Vocabulary: "trainer", Chinese: "è¨“ç·´å¸«" },
Â  { Vocabulary: "journey", Chinese: "æ—…ç¨‹ / ä¸€æ®µè·¯" },
Â  { Vocabulary: "rare", Chinese: "ç¨€æœ‰çš„" },
Â  { Vocabulary: "care", Chinese: "ç…§é¡§" },
Â  { Vocabulary: "decide", Chinese: "æ±ºå®š" },
Â  { Vocabulary: "pick", Chinese: "æŒ‘é¸" },
Â  { Vocabulary: "lab", Chinese: "å¯¦é©—å®¤" },
Â  { Vocabulary: "each", Chinese: "æ¯å€‹äºº" },
Â  { Vocabulary: "fluffy", Chinese: "æ¯›çµ¨çµ¨çš„" },
Â  { Vocabulary: "energetic", Chinese: "æœ‰æ´»åŠ›çš„" },
Â  { Vocabulary: "nod", Chinese: "é»é ­" },
Â  { Vocabulary: "electric", Chinese: "é›»çš„" },
Â  { Vocabulary: "icy", Chinese: "çµå‡çš„" },
Â  { Vocabulary: "punch", Chinese: "æ" },
Â  { Vocabulary: "wings", Chinese: "ç¿…è†€" },
Â  { Vocabulary: "horns", Chinese: "è§’" },
Â  { Vocabulary: "tail", Chinese: "å°¾å·´" },
Â  { Vocabulary: "furry", Chinese: "æœ‰æ¯›çš„" },
Â  { Vocabulary: "striped", Chinese: "æœ‰æ¢ç´‹çš„" },
Â  { Vocabulary: "claw", Chinese: "çˆªå­" },
Â  { Vocabulary: "library", Chinese: "åœ–æ›¸é¤¨" },
Â  { Vocabulary: "museum", Chinese: "åšç‰©é¤¨" },
Â  { Vocabulary: "backpack", Chinese: "èƒŒåŒ…" },
Â  { Vocabulary: "breakfast", Chinese: "æ—©é¤" },
Â  { Vocabulary: "hungry", Chinese: "è‚šå­é¤“çš„" },
Â  { Vocabulary: "dentist", Chinese: "ç‰™é†«" },
Â  { Vocabulary: "stationary", Chinese: "æ–‡å…·" },
Â  { Vocabulary: "friendly", Chinese: "å‹å–„çš„" },
Â  { Vocabulary: "exercise", Chinese: "é‹å‹•" },
Â  { Vocabulary: "science", Chinese: "ç§‘å­¸" },
Â  { Vocabulary: "noisy", Chinese: "åµçš„" },
Â  { Vocabulary: "brave", Chinese: "å‹‡æ•¢çš„" },
Â  { Vocabulary: "careful", Chinese: "å°å¿ƒçš„" },
Â  { Vocabulary: "weekend", Chinese: "é€±æœ«" }
];
let defaultData = [...data];
let questionSet = [];
let currentIndex = 0;
let attempts = 0;
let wrongCount = 0;
let totalQuestionsToComplete = "all"; // é è¨­ç‚ºå…¨éƒ¨å•é¡Œ
let score = 0;
let lives = 3;
let gameSession = Date.now();

function shuffle(array) {
Â  return array.sort(() => Math.random() - 0.5);
}

function updateProgressBar() {
Â  // å¦‚æœæ˜¯æ•¸å­—é™åˆ¶ï¼Œå‰‡ä»¥è©²é™åˆ¶ç‚ºæº–ï¼›å¦å‰‡ä»¥å…¨éƒ¨å•é¡Œæ•¸é‡ç‚ºæº–
Â  const totalQuestions = typeof totalQuestionsToComplete === 'number' ? 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â totalQuestionsToComplete : questionSet.length;
Â  const percent = (currentIndex / totalQuestions) * 100;
Â  document.getElementById("progress-bar").style.width = `${percent}%`;
}

function updateScoreDisplay() {
Â  document.getElementById("score-display").innerText = `ç›®å‰å¾—åˆ†ï¼š${score}`;
}

function updateLivesDisplay() {
Â  const hearts = 'â¤ï¸'.repeat(lives);
Â  document.getElementById("lives-display").innerText = `å‰©é¤˜ç”Ÿå‘½ï¼š${hearts}`;
}

function awardBadges() {
Â  const newBadges = [];
Â  if (score >= 25) newBadges.push("ğŸ–ï¸ é«˜åˆ†é”äºº");
Â  // ä¿®æ­£åˆ¤æ–·æ¢ä»¶ï¼Œä½¿ç”¨ totalQuestionsToComplete
Â  const total = typeof totalQuestionsToComplete === 'number' ? totalQuestionsToComplete : questionSet.length;
Â  if (wrongCount === 0 && currentIndex === total) newBadges.push("â­ å®Œç¾æŒ‘æˆ°");
Â  if (!badgesEarned.includes("ğŸ‰ é¦–æ¬¡æŒ‘æˆ°")) newBadges.push("ğŸ‰ é¦–æ¬¡æŒ‘æˆ°");

Â  newBadges.forEach(badge => {
Â  Â  if (!badgesEarned.includes(badge)) badgesEarned.push(badge);
Â  });

Â  localStorage.setItem("badges", JSON.stringify(badgesEarned));
Â  displayBadges();
}

function displayBadges() {
Â  const badgesContainer = document.getElementById("badges");
Â  badgesContainer.innerHTML = badgesEarned.length ? badgesEarned.map(badge => `<span>${badge}</span>`).join("") : "å°šæœªç²å¾—å¾½ç« ";
}

async function submitScore() {
Â  if (!GOOGLE_SCRIPT_URL.includes("YOUR")) {
Â  Â  try {
Â  Â  Â  const response = await fetch(GOOGLE_SCRIPT_URL, {
Â  Â  Â  Â  method: "POST",
Â  Â  Â  Â  mode: "no-cors",
Â  Â  Â  Â  headers: { "Content-Type": "application/json" },
Â  Â  Â  Â  body: JSON.stringify({
Â  Â  Â  Â  Â  username: window.username,
Â  Â  Â  Â  Â  score: score,
Â  Â  Â  Â  Â  session: gameSession,
Â  Â  Â  Â  Â  dataset: document.getElementById("dataset").options[document.getElementById("dataset").selectedIndex].text
Â  Â  Â  Â  })
Â  Â  Â  });

Â  Â  Â  console.log("åˆ†æ•¸å·²æäº¤è‡³ Google Sheets");
Â  Â  } catch (err) {
Â  Â  Â  console.error("æäº¤åˆ†æ•¸å¤±æ•—:", err);
Â  Â  }
Â  } else {
Â  Â  console.warn("æœªè¨­ç½® GOOGLE_SCRIPT_URLï¼Œåˆ†æ•¸æœªæäº¤");
Â  }
}

async function fetchLeaderboard() {
Â  if (!GOOGLE_SCRIPT_URL.includes("YOUR")) {
Â  Â  try {
Â  Â  Â  const response = await fetch(`${GOOGLE_SCRIPT_URL}?action=getLeaderboard`);
Â  Â  Â  const leaderboard = await response.json();

Â  Â  Â  // ä¾é¡Œåº«åç¨±åˆ†çµ„
Â  Â  Â  const grouped = {};
Â  Â  Â  leaderboard.forEach(entry => {
Â  Â  Â  Â  const key = entry.dataset || "æœªçŸ¥é¡Œåº«";
Â  Â  Â  Â  if (!grouped[key]) grouped[key] = [];
Â  Â  Â  Â  grouped[key].push(entry);
Â  Â  Â  });

Â  Â  Â  // æ¯çµ„å…§ä¾åˆ†æ•¸æ’åºï¼ˆé«˜â†’ä½ï¼‰ï¼ŒåŒåˆ†ä»¥æ™‚é–“ï¼ˆæ–°â†’èˆŠï¼‰
Â  Â  Â  for (const key in grouped) {
Â  Â  Â  Â  grouped[key].sort((a, b) => {
Â  Â  Â  Â  Â  if (b.score === a.score) {
Â  _ Â  Â  Â  Â  Â  return new Date(b.timestamp) - new Date(a.timestamp);
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  return b.score - a.score;
Â  Â  Â  Â  });
Â  Â  Â  Â  grouped[key] = grouped[key].slice(0, 10);
Â  Â  Â  }

Â  Â  Â  // ä¾å„é¡Œåº«æœ€æ–°ç´€éŒ„æ™‚é–“æ’åºï¼ˆæ–°â†’èˆŠï¼‰
Â  Â  Â  const sortedDatasets = Object.keys(grouped).sort((a, b) => {
Â  Â  Â  Â  const latestA = Math.max(...grouped[a].map(e => new Date(e.timestamp)));
Â  Â  Â  Â  const latestB = Math.max(...grouped[b].map(e => new Date(e.timestamp)));
Â  Â  Â  Â  return latestB - latestA;
Â  Â  Â  });

Â  Â  Â  // å–æœ€æ–°å…©å€‹é¡Œåº«é è¨­å±•é–‹
Â  Â  Â  const expandedDatasets = sortedDatasets.slice(0, 1);

Â  Â  Â  // ç”Ÿæˆæ’è¡Œæ¦œ HTML
Â  Â  Â  const leaderboardList = document.getElementById("leaderboard-list");

Â  Â  Â  // å…ˆæ’å…¥æ§åˆ¶æŒ‰éˆ•
Â  Â  Â  leaderboardList.innerHTML = `
Â  Â  Â  Â  <div style="text-align:center; margin:10px 0;">
Â  Â  Â  Â  Â  <button id="expand-all" style="
Â  Â  Â  Â  Â  Â  padding:6px 12px; 
Â  Â  Â  Â  Â  Â  margin-right:8px;
Â  Â  Â  Â  Â  Â  background:#007bff;
Â  Â  Â  Â  Â  Â  color:white;
Â  Â  Â  Â  Â  Â  border:none;
Â  Â  Â  Â  Â  Â  border-radius:6px;
Â  Â  Â  Â  Â  Â  cursor:pointer;
Â  Â  Â  Â  Â  ">å±•é–‹å…¨éƒ¨</button>
Â  Â  Â  Â  Â  <button id="collapse-all" style="
Â  Â  Â  Â  Â  Â  padding:6px 12px; 
Â  Â  Â  Â  Â  Â  background:#6c757d;
Â  Â  Â  Â  Â  Â  color:white;
Â  Â  Â  Â  Â  Â  border:none;
Â  Â  Â  Â  Â  Â  border-radius:6px;
Â  Â  Â  Â  Â  Â  cursor:pointer;
Â  Â  Â  Â  Â  ">å…¨éƒ¨æ”¶èµ·</button>
Â  Â  Â  Â  </div>
Â  Â  Â  `;

Â  Â  Â  // åŠ å…¥æ¯å€‹é¡Œåº«
Â  Â  Â  leaderboardList.innerHTML += sortedDatasets.map(dataset => {
Â  Â  Â  Â  const entries = grouped[dataset];
Â  Â  Â  Â  const latestTime = new Date(Math.max(...entries.map(e => new Date(e.timestamp))));
Â  Â  Â  Â  const isOpen = expandedDatasets.includes(dataset) ? "open" : "";
Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  <li style="list-style:none; margin-top:10px;">
Â  Â  Â  Â  Â  Â  <details ${isOpen} class="dataset-block" style="
Â  Â  Â  Â  Â  Â  Â  background:#fff; 
Â  Â  Â  Â  Â  Â  Â  border-radius:8px; 
Â  Â  Â  Â  Â  Â  Â  box-shadow:0 2px 5px rgba(0,0,0,0.05); 
Â  Â  Â  Â  Â  Â  Â  padding:10px;">
Â  Â  Â  Â  Â  Â  Â  <summary style="
Â  Â  Â  Â  Â  Â  Â  Â  cursor:pointer; 
Â  Â  Â  Â  Â  Â  Â  Â  font-weight:bold; 
Â  Â  Â  Â  Â  Â  Â  Â  color:#0072ff; 
Â  Â  Â  Â  Â  Â  Â  Â  font-size:1.1em;">
Â  Â  Â  Â  Â  Â  Â  Â  ğŸ“˜ ${dataset}
Â  Â  Â  Â  Â  Â  Â  Â  <small style="color:#888; font-weight:normal;">ï¼ˆæœ€æ–°æ›´æ–°ï¼š${latestTime.toLocaleString()}ï¼‰</small>
Â  Â  Â  Â  Â  Â  Â  </summary>
Â  Â  Â  Â  Â  Â  Â  <ul style="list-style:none; padding:6px 0 0 16px; margin:0;">
Â  Â  Â  Â  Â  Â  Â  Â  ${entries.map((entry, index) => `
Â  Â  Â  Â  Â  Â  Â  Â  Â  <li style="padding:6px 0; display:flex; justify-content:space-between; border-bottom:1px solid #eee;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>${index + 1}. ${entry.username}</span>
Â  Â  Â  Â  Â  G Â  Â  Â  Â  Â  <span>${entry.score}åˆ†ï½œ${new Date(entry.timestamp).toLocaleString()}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  </li>
Â  Â  Â  Â  Â  Â  Â  Â  `).join("")}
Â  Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  Â  </details>
Â  Â  Â  Â  Â  </li>
Â  Â  Â  Â  `;
Â  Â  Â  }).join("");

Â  Â  Â  // ç¶å®šå±•é–‹ï¼æ”¶èµ·æŒ‰éˆ•äº‹ä»¶
Â  Â  Â  document.getElementById("expand-all").addEventListener("click", () => {
Â  Â  Â  Â  document.querySelectorAll(".dataset-block").forEach(el => (el.open = true));
Â  Â  Â  });
Â  Â  Â  document.getElementById("collapse-all").addEventListener("click", () => {
Â  Â  Â  Â  document.querySelectorAll(".dataset-block").forEach(el => (el.open = false));
Â  Â  Â  });

Â  Â  } catch (err) {
Â  Â  Â  console.error("è¼‰å…¥æ’è¡Œæ¦œå¤±æ•—:", err);
Â  Â  Â  document.getElementById("leaderboard-list").innerHTML = "<li>ç„¡æ³•è¼‰å…¥æ’è¡Œæ¦œ</li>";
Â  Â  }
Â  } else {
Â  Â  document.getElementById("leaderboard-list").innerHTML = "<li>è«‹è¨­ç½® Google Sheets é€£çµ</li>";
Â  }
}



function endGame() {
Â  updateProgressBar();
Â  awardBadges();
Â  submitScore();
Â  fetchLeaderboard();
Â  document.querySelector(".quiz").innerHTML = `
Â  Â  <h2>ğŸ‰ ${window.username}ï¼Œæœ¬æ¬¡æŒ‘æˆ°çµæŸï¼</h2>
Â  Â  <h3>ç¸½å¾—åˆ†ï¼š${score}</h3>
Â  Â  <h3 id="result-title" style="margin-top:30px;"></h3>
Â  Â  <ul class="result-log" id="results">${document.getElementById("results").innerHTML}</ul>
Â  Â  <div class="badges" id="badges">${document.getElementById("badges").innerHTML}</div>
Â  Â  <div style="text-align: center; margin-top: 20px;">
Â  Â  Â  <button onclick="location.reload()" style="
Â  Â  Â  Â  padding: 12px 24px;
Â  Â  Â  Â  font-size: 1.1em; /* æ”¾å¤§ */
Â  Â  Â  Â  border: none;
Â  Â  Â  Â  border-radius: 30px;
Â  Â  Â  Â  background: linear-gradient(to right, #ff9f1a, #ffc107);
Â  Â  Â  Â  color: #333;
Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
Â  Â  Â  Â  transition: all 0.2s ease;
Â  Â  Â  " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
Â  Â  Â  Â  ğŸ” å†ç©ä¸€æ¬¡
Â  Â  Â  </button>
Â  Â  </div>`;
}

function renderQuestion() {
Â  // ç§»é™¤ä¸Šä¸€é¡Œçš„éœ‡å‹•æ•ˆæœ
Â  document.body.classList.remove("shake-it");
Â  attempts = 0;
Â  updateProgressBar();
Â  updateScoreDisplay();
Â  const q = questionSet[currentIndex];
Â  document.getElementById("question").innerText = `"${q.Vocabulary}" æ˜¯ä»€éº¼æ„æ€ï¼Ÿ`;
Â  speechSynthesis.cancel();
Â  if (!selectedVoice) selectedVoice = findEnglishVoice();
Â  const utterance = new SpeechSynthesisUtterance(q.Vocabulary);
Â  utterance.voice = selectedVoice;
Â  utterance.lang = "en-US";
Â  utterance.rate = 0.9;
Â  speechSynthesis.speak(utterance);

Â  // ä»å®Œæ•´æ•°æ®ä¸­éšæœºé€‰æ‹©å¹²æ‰°é¡¹
Â  const allChineseAnswers = data.map(item => item.Chinese);
Â  const correctAnswer = q.Chinese;
Â  // è¿‡æ»¤æ‰å½“å‰çš„æ­£ç¡®ç­”æ¡ˆ
Â  const possibleDistractors = allChineseAnswers.filter(chinese => chinese !== correctAnswer);
Â  // éšæœºé€‰æ‹©3ä¸ªå¹²æ‰°é¡¹
Â  const distractors = shuffle(possibleDistractors).slice(0, 3);

Â  // ç»„åˆé€‰é¡¹å¹¶éšæœºæ’åº
Â  const choices = shuffle([correctAnswer, ...distractors]).map(chinese => {
Â  Â  // ä¸ºæ¯ä¸ªé€‰é¡¹åˆ›å»ºä¸€ä¸ªæ¨¡æ‹Ÿå¯¹è±¡
Â  Â  return { Chinese: chinese };
Â  });

Â  const container = document.getElementById("options");
Â  container.innerHTML = "";

Â  choices.forEach((choice) => {
Â  Â  const btn = document.createElement("button");
Â  Â  btn.innerText = choice.Chinese;
Â  Â  btn.onclick = () => handleChoice(btn, choice);
Â  Â  container.appendChild(btn);
Â  });
}

function handleChoice(button, choice) {
Â  // æ’­æ”¾é»æ“ŠéŸ³æ•ˆ
Â  soundClick.play();

Â  const correctAnswer = questionSet[currentIndex].Chinese;
Â  attempts++;
Â Â 
Â  // ç«‹å³ç¦ç”¨æ‰€æœ‰æŒ‰éˆ•
Â  document.querySelectorAll(".options button").forEach(btn => btn.disabled = true);

Â  if (choice.Chinese === correctAnswer) {
Â  Â  // ç­”å°äº†
Â  Â  soundCorrect.play(); // æ’­æ”¾æ­£ç¢ºéŸ³æ•ˆ
Â  Â  button.classList.add("correct");
Â  Â Â 
Â  Â  if (currentIndex === 0 && !document.getElementById("result-title").innerText) {
Â  Â  Â  document.getElementById("result-title").innerText = `${window.username} çš„æŒ‘æˆ°çµæœï¼š`;
Â  Â  }
Â  Â  document.getElementById("results").innerHTML += 
Â  Â  Â  (attempts === 1
Â  Â  Â  Â  ? `<li>âœ… ${questionSet[currentIndex].Vocabulary} â€” ${questionSet[currentIndex].Chinese} â€” ${attempts} æ¬¡ â€” +5åˆ†</li>`
Â  Â  Â  Â  : `<li style="color: #d39e00;">ğŸŸ¡ ${questionSet[currentIndex].Vocabulary} â€” ${questionSet[currentIndex].Chinese} â€” ${attempts} æ¬¡ â€” 0åˆ†</li>`);
Â  Â Â 
Â  Â  if (attempts === 1) {
Â  Â  Â  score += 5;
Â  Â  }
Â  Â  updateScoreDisplay();

Â  Â  setTimeout(() => {
Â  Â  Â  currentIndex++;
Â  Â  Â  // æª¢æŸ¥æ˜¯å¦é”åˆ°å®Œæˆæ¢ä»¶
Â  Â  Â  const quizCompleted = typeof totalQuestionsToComplete === 'number' 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ? currentIndex >= totalQuestionsToComplete 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  : currentIndex >= questionSet.length;

Â  Â  Â  if (!quizCompleted) { // æª¢æŸ¥ !quizCompleted å°±å¥½ï¼Œlives çš„æª¢æŸ¥ç§»åˆ° else
Â  Â  Â  Â  renderQuestion();
Â  Â  Â  } else {
Â  Â  Â  Â  endGame();
Â  Â  Â  }
Â  Â  }, 800);
Â  } else {
Â  Â  // ç­”éŒ¯äº†
Â  Â  soundWrong.play(); // æ’­æ”¾éŒ¯èª¤éŸ³æ•ˆ
Â  Â  button.classList.add("incorrect");
Â  Â  // button.disabled = true; // å·²ç¶“åœ¨å‰é¢çµ±ä¸€ç¦ç”¨äº†
Â  Â Â 
Â  Â  // è§¸ç™¼éœ‡å‹•æ•ˆæœ
Â  Â  document.body.classList.add("shake-it");
Â  Â Â 
Â  Â  wrongCount++;
Â  Â  lives = 3 - wrongCount;
Â  Â  updateLivesDisplay();
Â  Â Â 
Â  Â  // è§£é–å…¶ä»–æŒ‰éˆ• (é™¤äº†é€™å€‹éŒ¯çš„)
Â  Â  document.querySelectorAll(".options button:not(.incorrect)").forEach(btn => btn.disabled = false);

Â  Â  if (lives <= 0) {
Â  Â  Â  // ç¦ç”¨æ‰€æœ‰æŒ‰éˆ•ï¼Œæº–å‚™çµæŸéŠæˆ²
Â  Â  Â  document.querySelectorAll(".options button").forEach(btn => btn.disabled = true);
Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  endGame();
Â  Â  Â  }, 800);
Â  Â  }
Â  }
}

function startQuiz() {
Â  console.log("startQuiz å‡½æ•¸å·²è§¸ç™¼");
Â  const name = document.getElementById("username").value.trim();
Â  if (!name) {
Â  Â  alert("è«‹è¼¸å…¥åå­—ï¼");
Â  Â  return;
Â  }
Â Â 
Â  const startButton = document.getElementById("start-btn");
Â  startButton.innerHTML = "ğŸ”Š é‡è½ç™¼éŸ³";
Â  startButton.onclick = function() {
Â  Â  speakCurrentWord();
Â  };
Â Â 
Â  document.getElementById("username").style.display = "none";
Â  document.querySelector("label[for='username']").style.display = "none";
Â Â 
Â  document.getElementById("progress-section").style.display = "block";
Â  document.querySelector(".quiz").style.display = "block";
Â  window.username = name;
Â  lives = 3;
Â Â 
Â  if (!questionSet.length) {
Â  Â  console.error("é¡Œåº«æœªåˆå§‹åŒ–ï¼Œå˜—è©¦ä½¿ç”¨é è¨­é¡Œåº«");
Â  Â  questionSet = shuffle([...defaultData]);
Â  }
Â Â 
Â  // ä¿®æ­£ï¼šç¢ºä¿ totalQuestionsToComplete åœ¨é–‹å§‹æ™‚è¢«æ­£ç¢ºè¨­å®š
Â  const selected = document.getElementById("dataset").options[document.getElementById("dataset").selectedIndex];
Â  const limit = selected.getAttribute("data-limit");
Â  totalQuestionsToComplete = limit === "all" ? "all" : parseInt(limit);
Â Â 
Â  // å¦‚æœè¨­å®šäº†é™åˆ¶ï¼Œå°±å¾é¡Œåº«ä¸­å–å‡ºé™åˆ¶çš„æ•¸é‡
Â  if (typeof totalQuestionsToComplete === 'number' && questionSet.length > totalQuestionsToComplete) {
Â  Â  questionSet = questionSet.slice(0, totalQuestionsToComplete);
Â  }
Â Â 
Â  try {
Â  Â  fetchLeaderboard();
Â  } catch (err) {
Â  Â  console.warn("æ’è¡Œæ¦œè¼‰å…¥å¤±æ•—ï¼Œç¹¼çºŒåŸ·è¡ŒéŠæˆ²");
G }
Â Â 
Â  renderQuestion();
}

function speakCurrentWord() {
Â  // æª¢æŸ¥æ˜¯å¦æœ‰é¡Œç›® (éŠæˆ²çµæŸæ™‚ currentIndex å¯èƒ½è¶Šç•Œ)
Â  if (questionSet[currentIndex]) {
Â  Â  const currentWord = questionSet[currentIndex].Vocabulary;
Â  Â  speechSynthesis.cancel();
Â  Â  if (!selectedVoice) selectedVoice = findEnglishVoice();
Â  Â  const utterance = new SpeechSynthesisUtterance(currentWord);
Â  Â  utterance.voice = selectedVoice;
Â  Â  utterance.lang = "en-US";
Â  Â  utterance.rate = 0.9;
Â  Â  speechSynthesis.speak(utterance);
Â  }
}

document.addEventListener("keydown", function(event) {
Â  if (event.key === "Enter") {
Â  Â  const input = document.getElementById("username");
Â  Â  if (input && input.style.display !== "none") {
Â  Â  Â  startQuiz();
Â  Â  }
Â  }
});

document.getElementById("dataset").addEventListener("change", async function(e) {
Â  const file = e.target.value;
Â  const selected = e.target.options[e.target.selectedIndex];
Â  const limit = selected.getAttribute("data-limit");
Â Â 
Â  // è¨­å®šç•¶å‰é¸æ“‡çš„é¡Œåº«çš„é¡Œç›®é™åˆ¶
Â  totalQuestionsToComplete = limit === "all" ? "all" : parseInt(limit);
Â Â 
Â  try {
Â  Â  // è®€å–æª”æ¡ˆ...
Â  Â  const res = await fetch(file);
Â  Â  if (!res.ok) {
Â  Â  Â  throw new Error(`HTTP éŒ¯èª¤ï¼Œç‹€æ…‹ç¢¼ï¼š${res.status}`);
Â  Â  }
Â  Â  data = await res.json(); // data å§‹çµ‚æ˜¯å®Œæ•´é¡Œåº«
Â  Â  questionSet = shuffle([...data]); // questionSet æ˜¯æ´—ç‰Œå¾Œçš„å®Œæ•´é¡Œåº«
Â  Â Â 
Â  Â  // å¦‚æœè¨­å®šäº†é™åˆ¶ï¼Œå°±å¾é¡Œåº«ä¸­å–å‡ºé™åˆ¶çš„æ•¸é‡
Â  Â  if (typeof totalQuestionsToComplete === 'number' && questionSet.length > totalQuestionsToComplete) {
Â  Â  Â  questionSet = questionSet.slice(0, totalQuestionsToComplete);
Â  Â  }
Â  Â Â 
Â  Â  currentIndex = 0;
Â  Â  wrongCount = 0;
Â  Â  score = 0;
Â  Â  lives = 3;
Â  Â  updateProgressBar();
Â  Â  updateScoreDisplay();
Â  Â  updateLivesDisplay();
Â  Â  if (document.querySelector(".quiz").style.display === "block") {
Â  Â  Â  document.getElementById("results").innerHTML = "";
Â  Â  Â  document.getElementById("result-title").innerText = "";
Â  Â  Â  renderQuestion();
Â  Â  }
Â  } catch (err) {
Â  Â  console.warn("è¼‰å…¥é¡Œåº«å¤±æ•—ï¼Œä½¿ç”¨é è¨­é¡Œåº«");
Â  Â  data = [...defaultData];
Â  Â  questionSet = shuffle([...data]);
Â  Â  // åŒæ¨£æ‡‰ç”¨é™åˆ¶
Â  Â  if (typeof totalQuestionsToComplete === 'number' && questionSet.length > totalQuestionsToComplete) {
Â  Â  Â  questionSet = questionSet.slice(0, totalQuestionsToComplete);
Â  Â  }
Â  Â  currentIndex = 0;
Â  Â  wrongCount = 0;
Â  Â  score = 0;
Â  Â  lives = 3;
Â  Â  updateProgressBar();
Â  Â  updateScoreDisplay();
Â  Â  updateLivesDisplay();
Â  Â  if (document.querySelector(".quiz").style.display === "block") {
Â  Â  Â  document.getElementById("results").innerHTML = "";
Â  Â  Â  document.getElementById("result-title").innerText = "";
Â  Â  Â  renderQuestion();
Â  Â  }
Â  }
});

(async () => {
Â  console.log("é é¢åˆå§‹åŒ–é–‹å§‹");
Â  const file = document.getElementById("dataset").value;
Â  const selected = document.getElementById("dataset").options[document.getElementById("dataset").selectedIndex];
Â  const limit = selected.getAttribute("data-limit");
Â Â 
Â  // è¨­å®šåˆå§‹é¡Œåº«çš„é¡Œç›®é™åˆ¶
Â  totalQuestionsToComplete = limit === "all" ? "all" : parseInt(limit);
Â  try {
Â  Â  const res = await fetch(file);
Â  Â  if (!res.ok) {
Â  Â  Â  throw new Error(`HTTP éŒ¯èª¤ï¼Œç‹€æ…‹ç¢¼ï¼š${res.status}`);
Â  Â  }
Â  Â  data = await res.json();
Â  } catch (err) {
Â  Â  console.warn("åˆå§‹é¡Œåº«è¼‰å…¥å¤±æ•—ï¼Œä½¿ç”¨é è¨­é¡Œåº«");
Â  Â  data = [...defaultData];
Â  }
Â  questionSet = shuffle([...data]);
Â Â 
Â  // åˆå§‹è¼‰å…¥æ™‚ä¹Ÿæ‡‰ç”¨é™åˆ¶
Â  if (typeof totalQuestionsToComplete === 'number' && questionSet.length > totalQuestionsToComplete) {
Â  Â  questionSet = questionSet.slice(0, totalQuestionsToComplete);
Â  }
Â Â 
Â  currentIndex = 0;
Â  wrongCount = 0;
Â  score = 0;
Â  lives = 3;
Â  updateProgressBar();
Â  updateScoreDisplay();
Â  updateLivesDisplay();
Â  try {
Â  Â  fetchLeaderboard();
Â  } catch (err) {
Â  Â  console.warn("åˆå§‹æ’è¡Œæ¦œè¼‰å…¥å¤±æ•—");
Good }
Â  displayBadges();
Â  console.log("é é¢åˆå§‹åŒ–å®Œæˆ");
})();
Â  </script>

Â  <div style="margin-top: 60px; font-size: 0.9em; color: #aaa; text-align: center;">
Â  Â  Made by Evelyn YT ï½œÂ© 2025 | 2025/11/9 22:46
Â  </div>
</body>
</html>
