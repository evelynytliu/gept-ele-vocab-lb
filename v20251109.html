<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è‹±æ–‡å–®å­—å¡ï½œéŒ„éŸ³ä¸Šå‚³ç‰ˆ</title>
<style>
  body {
    font-family: "Noto Sans TC", sans-serif;
    background: linear-gradient(180deg, #f0f9ff, #ffffff);
    margin: 0;
    padding: 30px;
    color: #333;
  }
  h1 {
    text-align: center;
    color: #0078b7;
    margin-bottom: 10px;
  }
  .name-box {
    text-align: center;
    margin-bottom: 25px;
  }
  .name-box input {
    padding: 8px 12px;
    border-radius: 8px;
    border: 1px solid #ccc;
    width: 220px;
    font-size: 1em;
  }
  .card-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 20px;
  }
  .card {
    background-color: #fff;
    border: 2px solid #cce7ff;
    border-radius: 16px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.05);
    padding: 18px 16px;
    transition: transform 0.2s, box-shadow 0.2s;
  }
  .card:hover {
    transform: translateY(-4px);
    box-shadow: 0 6px 14px rgba(0,0,0,0.08);
  }
  .word {
    font-size: 1.4em;
    font-weight: 600;
    color: #005c8c;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .meaning {
    font-size: 1.05em;
    color: #444;
    margin-bottom: 8px;
  }
  .example {
    font-size: 0.95em;
    color: #333;
    line-height: 1.4;
  }
  .controls {
    margin-top: 8px;
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }
  button {
    border: none;
    padding: 6px 10px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.9em;
    transition: background 0.2s;
  }
  .play { background: #ffe1d2; color: #ff5c39; }
  .record { background: #ffd9ec; color: #d6006f; }
  .stop { background: #ffe1a0; color: #8a5b00; }
  .upload { background: #cce5ff; color: #0056b3; }
  .play:hover { background: #ffd4c0; }
  .record:hover { background: #ffcce0; }
  .stop:hover { background: #ffd98a; }
  .upload:hover { background: #b8daff; }
  audio { margin-top: 6px; width: 100%; }
</style>
</head>
<body>
<h1>ğŸŒŸ è‹±æ–‡å–®å­—å¡ï¼šéŒ„éŸ³ä¸Šå‚³ç‰ˆ</h1>

<div class="name-box">
  <label for="studentName">è«‹è¼¸å…¥ä½ çš„è‹±æ–‡åå­—ï¼š</label>
  <input type="text" id="studentName" placeholder="ä¾‹å¦‚ï¼šMiles" />
</div>

<div class="card-container" id="cards"></div>

<script>
const UPLOAD_URL = "https://script.google.com/macros/s/AKfycbylkOwv2Dq7nQyzwzH6-YuLOdW1KJbLYUpbHZaPzFWpFrjgEcEDRrpp3aPxdUlUp-MTHA/exec";

const data = [
  {v:"discuss",c:"è¨è«–",e:"We discussed our weekend plans."},
  {v:"used to",c:"éå»å¸¸å¸¸ï¼ˆåšæŸäº‹ï¼‰",e:"I used to play basketball every day."},
  {v:"employee",c:"å“¡å·¥",e:"My father is an employee in a big company."},
  {v:"formal",c:"æ­£å¼çš„",e:"You should wear formal clothes to the meeting."},
  {v:"take place",c:"ç™¼ç”Ÿï¼›èˆ‰è¡Œ",e:"The party will take place on Saturday."},
  {v:"attend",c:"å‡ºå¸­ï¼›åƒåŠ ",e:"I will attend my friend's wedding."},
  {v:"dessert",c:"ç”œé»",e:"Ice cream is my favorite dessert."},
  {v:"come up with",c:"æƒ³å‡ºï¼›æå‡ºï¼ˆä¸»æ„ï¼‰",e:"She came up with a great idea."},
  {v:"in person",c:"è¦ªè‡ª",e:"You must sign the paper in person."},
  {v:"actor",c:"ç”·æ¼”å“¡",e:"He is a famous actor."},
  {v:"effect",c:"æ•ˆæœï¼›å½±éŸ¿",e:"The new medicine has a good effect."},
  {v:"regular",c:"è¦å¾‹çš„ï¼›å›ºå®šçš„",e:"She takes regular exercise every day."},
  {v:"suggest",c:"å»ºè­°",e:"I suggest we go by bus."},
  {v:"deal with",c:"è™•ç†ï¼›æ‡‰ä»˜",e:"He can deal with stress very well."},
  {v:"damage",c:"æå®³ï¼›ç ´å£",e:"The typhoon damaged many houses."},
  {v:"be known for",c:"ä»¥â€¦èå",e:"Taiwan is known for its delicious food."},
  {v:"particular",c:"ç‰¹åˆ¥çš„ï¼›ç‰¹å®šçš„",e:"I like this particular song."},
  {v:"diary",c:"æ—¥è¨˜",e:"She writes in her diary every night."},
  {v:"advertisement",c:"å»£å‘Š",e:"I saw an advertisement for a new phone."},
  {v:"purpose",c:"ç›®çš„",e:"The purpose of the meeting is to plan the trip."},
  {v:"serious",c:"èªçœŸçš„ï¼›åš´é‡çš„",e:"He made a serious mistake."},
  {v:"introduce",c:"ä»‹ç´¹",e:"Let me introduce my best friend."},
  {v:"fit",c:"åˆèº«ï¼›é©åˆï¼›èº«æå¥½",e:"These shoes fit me well."},
  {v:"work out",c:"é‹å‹•ï¼›è§£æ±ºå•é¡Œ",e:"My parents work out at the gym."},
  {v:"prefer",c:"æ¯”è¼ƒå–œæ­¡",e:"I prefer tea to coffee."},
  {v:"relative",c:"è¦ªæˆš",e:"We visited our relatives last weekend."},
  {v:"usual",c:"å¹³å¸¸çš„ï¼›æ…£å¸¸çš„",e:"He came home at his usual time."},
  {v:"habit",c:"ç¿’æ…£",e:"Reading before bed is a good habit."},
  {v:"above all",c:"æœ€é‡è¦çš„æ˜¯",e:"Above all, be kind to others."},
  {v:"look forward to",c:"æœŸå¾…",e:"I look forward to seeing you soon."},
  {v:"locate",c:"æ‰¾åˆ°ï¼›ä½æ–¼",e:"The hotel is located near the beach."},
  {v:"entire",c:"æ•´å€‹çš„ï¼›å…¨éƒ¨çš„",e:"The entire family went on vacation."},
  {v:"product",c:"ç”¢å“",e:"This is our best-selling product."},
  {v:"mention",c:"æåˆ°",e:"He didnâ€™t mention your name."},
  {v:"activity",c:"æ´»å‹•",e:"The school has many fun activities."},
  {v:"club",c:"ä¿±æ¨‚éƒ¨ï¼›ç¤¾åœ˜",e:"I joined the English club."},
  {v:"available",c:"å¯ç”¨çš„ï¼›å¯å–å¾—çš„ï¼›ï¼ˆäººï¼‰æœ‰ç©ºçš„",e:"The teacher is available after class."},
  {v:"borrow",c:"å€Ÿï¼ˆé€²ï¼‰",e:"Can I borrow your pencil?"},
  {v:"single-story",c:"å–®å±¤çš„ï¼ˆå»ºç¯‰ï¼‰",e:"We live in a single-story house."},
  {v:"boarding gate",c:"ç™»æ©Ÿé–€",e:"Our flight leaves from boarding gate 10."},
  {v:"boil",c:"ç…®æ²¸ï¼›ç‡’é–‹",e:"Please boil some water for tea."},
  {v:"stress out",c:"å£“åŠ›å¤ªå¤§ï¼›æ„Ÿåˆ°ç„¦æ…®",e:"Donâ€™t stress out about the test."},
  {v:"line up",c:"æ’éšŠ",e:"The students lined up for lunch."},
  {v:"behave",c:"è¡¨ç¾ï¼›èˆ‰æ­¢",e:"Please behave in class."},
  {v:"disappear",c:"æ¶ˆå¤±",e:"The sun disappeared behind the clouds."},
  {v:"hostel",c:"æ—…èˆï¼›é’å¹´æ—…é¤¨",e:"We stayed in a cheap hostel."},
  {v:"price",c:"åƒ¹æ ¼",e:"The price of this book is 200 dollars."},
  {v:"less",c:"è¼ƒå°‘çš„",e:"I eat less sugar now."},
  {v:"teenager",c:"é’å°‘å¹´",e:"That teenager is my cousin."},
  {v:"search",c:"æœå°‹ï¼›å°‹æ‰¾",e:"I searched the Internet for the answer."}
];


const container = document.getElementById("cards");

data.forEach((item, index) => {
  const card = document.createElement("div");
  card.className = "card";
  card.innerHTML = `
    <div class="word">${item.v}
      <button class="play" onclick="playWord('${item.v}')">ğŸ”Š</button>
    </div>
    <div class="meaning">${item.c}</div>
    <div class="example">${item.e}</div>
    <div class="controls">
      <button class="play" onclick="playSentence('${item.e}')">ğŸ”Š ä¾‹å¥</button>
      <button class="record" onclick="startRecording(${index}, '${item.v}')">ğŸ™ï¸ éŒ„éŸ³</button>
      <button class="stop" onclick="stopRecording(${index})" disabled>â¹ï¸ åœæ­¢</button>
      <button class="upload" onclick="uploadRecording(${index}, '${item.v}')" disabled>â˜ï¸ ä¸Šå‚³</button>
    </div>
    <audio id="audio${index}" controls hidden></audio>
  `;
  container.appendChild(card);
});

let mediaRecorder;
let audioChunks = [];
let currentIndex = null;

async function startRecording(index, word) {
  const recordBtn = document.getElementsByClassName("record")[index];
  const stopBtn = document.getElementsByClassName("stop")[index];
  recordBtn.disabled = true;
  stopBtn.disabled = false;

  try {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    mediaRecorder = new MediaRecorder(stream);
    audioChunks = [];
    currentIndex = index;

    mediaRecorder.ondataavailable = e => { audioChunks.push(e.data); };
    mediaRecorder.onstop = () => {
      const blob = new Blob(audioChunks, { type: "audio/webm" });
      const audioURL = URL.createObjectURL(blob);
      const audioEl = document.getElementById(`audio${index}`);
      audioEl.src = audioURL;
      audioEl.hidden = false;
      document.getElementsByClassName("upload")[index].disabled = false;
    };

    mediaRecorder.start();
  } catch (err) {
    alert("éŒ„éŸ³å¤±æ•—ï¼Œè«‹ç¢ºèªå·²å…è¨±éº¥å…‹é¢¨æ¬Šé™ã€‚");
    console.error(err);
  }
}

function stopRecording(index) {
  const recordBtn = document.getElementsByClassName("record")[index];
  const stopBtn = document.getElementsByClassName("stop")[index];
  recordBtn.disabled = false;
  stopBtn.disabled = true;

  if (mediaRecorder && mediaRecorder.state !== "inactive") {
    mediaRecorder.stop();
  }
}

function playWord(word) {
  const url = `https://ssl.gstatic.com/dictionary/static/sounds/20200429/${encodeURIComponent(word)}--_us_1.mp3`;
  const audio = new Audio(url);
  audio.play().catch(() => {
    const utter = new SpeechSynthesisUtterance(word);
    utter.lang = 'en-US';
    speechSynthesis.speak(utter);
  });
}

function playSentence(sentence) {
const utter = new SpeechSynthesisUtterance(sentence);
utter.lang = 'en-US';
utter.rate = 0.8; // 0.5~1.0 éƒ½å¯ä»¥è©¦ï¼Œ1 æ˜¯æ­£å¸¸é€Ÿåº¦
speechSynthesis.speak(utter);
}

async function uploadRecording(index, word) {
  const studentName = document.getElementById("studentName").value.trim();
  if (!studentName) {
    alert("è«‹å…ˆè¼¸å…¥ä½ çš„è‹±æ–‡åå­—ï¼");
    return;
  }
  const audioEl = document.getElementById(`audio${index}`);
  const response = await fetch(audioEl.src);
  const blob = await response.blob();
  const formData = new FormData();
  const timestamp = new Date().toISOString().replace(/[:.]/g, "-");
  const filename = `${studentName}_${word}_${timestamp}.webm`;
  formData.append("file", blob, filename);
  formData.append("filename", filename);

  const uploadBtn = document.getElementsByClassName("upload")[index];
  uploadBtn.textContent = "â³ ä¸Šå‚³ä¸­...";
  uploadBtn.disabled = true;

  try {
    const res = await fetch(UPLOAD_URL, { method: "POST", body: formData });
    const result = await res.json();
    if (result.status === "success") {
      uploadBtn.textContent = "âœ… å·²ä¸Šå‚³";
    } else {
      uploadBtn.textContent = "âš ï¸ å¤±æ•—";
      console.error(result.message);
    }
  } catch (err) {
    uploadBtn.textContent = "âš ï¸ éŒ¯èª¤";
    console.error(err);
  }
}
</script>
</body>
</html>
