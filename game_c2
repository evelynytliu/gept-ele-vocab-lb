<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GEPT Vocabulary Battle âš¡</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --accent-cyan: #00e0ff;
      --accent-lime: #00ff9d;
      --accent-pink: #ff4b9f;
      --bg-deep: #050816;
      --card-bg: rgba(8, 16, 32, 0.9);
      --border-glow: rgba(0, 224, 255, 0.4);
      --text-main: #f5f7ff;
      --text-muted: #9ca3c4;
      --danger: #ff3860;
      --success: #00ff9d;
      --shadow-strong: 0 18px 40px rgba(0, 0, 0, 0.7);
    }
    body.light {
      --bg-deep: #f8fafc;
      --card-bg: #ffffff;
      --border-glow: rgba(0, 0, 0, 0.1);
      --text-main: #1e293b;
      --text-muted: #64748b;
      background: linear-gradient(180deg, #f9fafb, #e2e8f0);
    }
    body {
      font-family: "Poppins", sans-serif;
      max-width: 960px;
      margin: 24px auto;
      padding: 16px;
      color: var(--text-main);
      background: radial-gradient(circle at top, #1b2845 0, #050816 55%, #000 100%);
      transition: background 0.4s ease, color 0.4s ease;
    }
    h1 {
      text-align: center;
      color: var(--accent-cyan);
      text-shadow: 0 0 10px rgba(0, 224, 255, 0.9);
    }
    .game-card {
      background: var(--card-bg);
      border-radius: 24px;
      padding: 20px;
      box-shadow: var(--shadow-strong);
      border: 1px solid var(--border-glow);
    }
    #theme-toggle {
      position: absolute;
      top: 20px;
      right: 20px;
      background: linear-gradient(90deg, var(--accent-cyan), var(--accent-lime));
      border: none;
      border-radius: 999px;
      padding: 6px 12px;
      color: #111;
      font-weight: bold;
      cursor: pointer;
    }
    #today-best {
      background: linear-gradient(90deg, #ff9f1a, #ffc107);
      color: #111;
      padding: 6px 14px;
      border-radius: 999px;
      text-align: center;
      font-weight: 600;
      width: fit-content;
      margin: 10px auto;
      box-shadow: 0 0 12px rgba(255, 193, 7, 0.6);
    }
  </style>
</head>
<body>
  <button id="theme-toggle">â˜€ï¸ / ğŸŒ™</button>
  <div class="game-card">
    <h1>GEPT å–®å­—å°æˆ° âš¡</h1>
    <div id="today-best">ä»Šæ—¥æœ€é«˜åˆ†ï¼šè¼‰å…¥ä¸­â€¦</div>
    <div style="text-align:center; margin-bottom:10px;">
      <label>åå­—ï¼š</label>
      <input id="username" placeholder="ä½ çš„åå­—" style="padding:8px;border-radius:6px;border:1px solid #ccc;">
      <button id="start" onclick="startQuiz()" style="padding:8px 12px;border:none;background:linear-gradient(90deg,#00e0ff,#00ff9d);border-radius:6px;cursor:pointer;">é–‹å§‹æŒ‘æˆ°</button>
    </div>
    <div id="quiz" style="display:none;text-align:center;">
      <h2 id="question"></h2>
      <div id="options"></div>
      <div id="score"></div>
    </div>
    <div class="leaderboard">
      <h3 style="text-align:center;">ğŸ† æ’è¡Œæ¦œ</h3>
      <div id="leaderboard-loading" style="text-align:center;">
        <div style="border:4px solid #ccc;border-top:4px solid #00e0ff;border-radius:50%;width:30px;height:30px;animation:spin 1s linear infinite;margin:10px auto;"></div>
        <p>æ’è¡Œæ¦œè¼‰å…¥ä¸­...</p>
      </div>
      <ul id="leaderboard-list" style="list-style:none;padding:0;text-align:center;"></ul>
    </div>
  </div>
  <script>
    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyg8OvuiCZbrtUTBy6a1pKyWeGUZJJbCJsxeodvwgbs9I2o6Fe7dS_irIntu44SNmJrig/exec";
    const themeBtn = document.getElementById('theme-toggle');
    themeBtn.addEventListener('click',()=>{
      document.body.classList.toggle('light');
    });
    function startQuiz(){
      document.getElementById('quiz').style.display='block';
    }
    async function fetchLeaderboard(){
      const res = await fetch(`${GOOGLE_SCRIPT_URL}?action=getLeaderboard`);
      const data = await res.json();
      const latestGroup = data[data.length-1]?.dataset;
      const today = new Date().toISOString().split('T')[0];
      const todayScores = data.filter(d=>d.timestamp.startsWith(today));
      const best = todayScores.length? Math.max(...todayScores.map(d=>d.score)):"ç„¡ç´€éŒ„";
      document.getElementById('today-best').innerText = `ä»Šæ—¥æœ€é«˜åˆ†ï¼š${best}`;
      document.getElementById('leaderboard-loading').style.display='none';
      const ul = document.getElementById('leaderboard-list');
      data.slice(-5).forEach(item=>{
        const li = document.createElement('li');
        li.innerText=`${item.username}: ${item.score}`;
        ul.appendChild(li);
      });
    }
    fetchLeaderboard();
  </script>
  <style>@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}</style>
</body>
</html>
