<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GEPT Vocabulary Quiz</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 700px;
      margin: 40px auto;
      padding: 20px;
      background: linear-gradient(135deg, #ecf0f3, #ffffff);
      color: #333;
    }
    h1 {
      text-align: center;
      color: #2c3e50;
      font-size: 2em;
    }
    .progress-container {
      height: 16px;
      background: #ddd;
      border-radius: 10px;
      margin: 20px 0;
      overflow: hidden;
    }
    .progress-bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(to right, #00c6ff, #0072ff);
      transition: width 0.3s ease-in-out;
    }
    .question {
      font-size: 1.5em;
      margin: 1.2em 0;
      text-align: center;
    }
    .options {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    .options button {
      padding: 16px;
      font-size: 1.1em;
      font-weight: 600;
      border: none;
      border-radius: 30px;
      background: #e0e5ec;
      box-shadow: 6px 6px 12px #c5c8cb, -6px -6px 12px #ffffff;
      transition: all 0.2s ease-in-out;
      cursor: pointer;
    }
    .options button:hover {
      background: #d0d7de;
    }
    .options button.correct {
      background: #d4edda;
      color: #155724;
      box-shadow: inset 4px 4px 8px #b1cbbb;
    }
    .options button.incorrect {
      background: #f8d7da;
      color: #721c24;
      box-shadow: inset 4px 4px 8px #e5b7b9;
    }
    .result-log {
      margin-top: 30px;
    }
    .result-log li {
      margin: 5px 0;
      font-size: 0.95em;
    }
    .score-display {
      text-align: center;
      font-size: 1.2em;
      margin: 10px 0;
      color: #2c3e50;
    }
  </style>
</head>
<body>
  <h1>GEPTåˆç´š å–®å­—æŒ‘æˆ°</h1>
  
  <div style="text-align: center; margin-top: 10px;">
    <label for="dataset">é¡Œåº«é¸æ“‡ï¼š</label>
    <select id="dataset" style="padding: 6px 10px; font-size: 1em;">
      <option value="week1.json">ğŸŸ¡ Week 1</option>
      <option value="gept-full.json">ğŸ”µ å…¨ GEPT</option>
    </select>
  </div>
  <div style="text-align: center; margin-top: 20px;">
    <label for="username">è«‹è¼¸å…¥ä½ çš„åå­—ï¼š</label>
    <input id="username" type="text" placeholder="ä¾‹å¦‚ï¼šEmmett" style="padding: 8px 12px; font-size: 1em; border-radius: 8px; border: 1px solid #ccc; margin-top: 8px;" />
    <button onclick="startQuiz()" style="margin-left: 10px; padding: 8px 16px; font-size: 1em; border-radius: 8px; background-color: #007bff; color: white; border: none; cursor: pointer;">é–‹å§‹æŒ‘æˆ°</button>
  </div>

  <div class="progress-container" style="display:none;" id="progress-section">
    <div class="progress-bar" id="progress-bar"></div>
  </div>
  <div class="quiz" style="display:none;">
    <div class="score-display" id="score-display">ç›®å‰å¾—åˆ†ï¼š0</div>
    <div class="question" id="question"></div>
    <div class="options" id="options"></div>
    <h3 id="result-title" style="margin-top:30px;"></h3>
    <ul class="result-log" id="results"></ul>
  </div>

  <script>
let selectedVoice = null;

function findEnglishVoice() {
  const voices = speechSynthesis.getVoices();
  const priority = ['Google US English', 'Samantha', 'Microsoft Aria Online (Natural) - English (United States)', 'Microsoft Zira', 'Microsoft David', 'Karen', 'Alex'];
  for (const name of priority) {
    const match = voices.find(v => v.name.includes(name));
    if (match) return match;
  }
  return voices.find(v => v.lang === 'en-US') || voices[0];
}

speechSynthesis.onvoiceschanged = () => {
  selectedVoice = findEnglishVoice();
};
    
    let data = [
      { Vocabulary: "breathe fire", Chinese: "å™´ç«" },
      { Vocabulary: "trainer", Chinese: "è¨“ç·´å¸«" },
      { Vocabulary: "journey", Chinese: "æ—…ç¨‹ / ä¸€æ®µè·¯" },
      { Vocabulary: "rare", Chinese: "ç¨€æœ‰çš„" },
      { Vocabulary: "care", Chinese: "ç…§é¡§" },
      { Vocabulary: "decide", Chinese: "æ±ºå®š" },
      { Vocabulary: "pick", Chinese: "æŒ‘é¸" },
      { Vocabulary: "lab", Chinese: "å¯¦é©—å®¤" },
      { Vocabulary: "each", Chinese: "æ¯å€‹äºº" },
      { Vocabulary: "fluffy", Chinese: "æ¯›çµ¨çµ¨çš„" },
      { Vocabulary: "energetic", Chinese: "æœ‰æ´»åŠ›çš„" },
      { Vocabulary: "nod", Chinese: "é»é ­" },
      { Vocabulary: "electric", Chinese: "é›»çš„" },
      { Vocabulary: "icy", Chinese: "çµå‡çš„" },
      { Vocabulary: "punch", Chinese: "æ" },
      { Vocabulary: "wings", Chinese: "ç¿…è†€" },
      { Vocabulary: "horns", Chinese: "è§’" },
      { Vocabulary: "tail", Chinese: "å°¾å·´" },
      { Vocabulary: "furry", Chinese: "æœ‰æ¯›çš„" },
      { Vocabulary: "striped", Chinese: "æœ‰æ¢ç´‹çš„" },
      { Vocabulary: "claw", Chinese: "çˆªå­" },
      { Vocabulary: "library", Chinese: "åœ–æ›¸é¤¨" },
      { Vocabulary: "museum", Chinese: "åšç‰©é¤¨" },
      { Vocabulary: "backpack", Chinese: "èƒŒåŒ…" },
      { Vocabulary: "breakfast", Chinese: "æ—©é¤" },
      { Vocabulary: "hungry", Chinese: "è‚šå­é¤“çš„" },
      { Vocabulary: "dentist", Chinese: "ç‰™é†«" },
      { Vocabulary: "stationary", Chinese: "æ–‡å…·" },
      { Vocabulary: "friendly", Chinese: "å‹å–„çš„" },
      { Vocabulary: "exercise", Chinese: "é‹å‹•" },
      { Vocabulary: "science", Chinese: "ç§‘å­¸" },
      { Vocabulary: "noisy", Chinese: "åµçš„" },
      { Vocabulary: "brave", Chinese: "å‹‡æ•¢çš„" },
      { Vocabulary: "careful", Chinese: "å°å¿ƒçš„" },
      { Vocabulary: "weekend", Chinese: "é€±æœ«" }
    ];

    let defaultData = [...data];
    let questionSet = [];
    let currentIndex = 0;
    let attempts = 0;
    let wrongCount = 0;
    let score = 0;

    function shuffle(array) {
      return array.sort(() => Math.random() - 0.5);
    }

    function updateProgressBar() {
      const percent = (currentIndex / questionSet.length) * 100;
      document.getElementById("progress-bar").style.width = `${percent}%`;
    }

    function updateScoreDisplay() {
      document.getElementById("score-display").innerText = `ç›®å‰å¾—åˆ†ï¼š${score}`;
    }

    function endGame() {
      updateProgressBar();
      document.querySelector(".quiz").innerHTML = `
        <h2>ğŸ‰ ${window.username}ï¼Œæœ¬æ¬¡æŒ‘æˆ°çµæŸï¼</h2>
        <h3>ç¸½å¾—åˆ†ï¼š${score}</h3>
        <h3 id="result-title" style="margin-top:30px;"></h3>
        <ul class="result-log" id="results">${document.getElementById("results").innerHTML}</ul>
        <div style="text-align: center; margin-top: 20px;">
          <button onclick="location.reload()" style="
            padding: 12px 24px;
            font-size: 1em;
            border: none;
            border-radius: 30px;
            background: linear-gradient(to right, #ff9f1a, #ffc107);
            color: #333;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 4px 4px 10px rgba(0,0,0,0.1);
          ">ğŸ” å†ç©ä¸€æ¬¡</button>
        </div>`;
    }

    function renderQuestion() {
      attempts = 0;
      updateProgressBar();
      updateScoreDisplay();
      const q = questionSet[currentIndex];
      document.getElementById("question").innerText = `"${q.Vocabulary}" æ˜¯ä»€éº¼æ„æ€ï¼Ÿ`;
      speechSynthesis.cancel();
      if (!selectedVoice) selectedVoice = findEnglishVoice();
      const utterance = new SpeechSynthesisUtterance(q.Vocabulary);
      utterance.voice = selectedVoice;
      utterance.lang = "en-US";
      utterance.rate = 0.9;
      speechSynthesis.speak(utterance);

      const distractors = shuffle(
        data.filter(item => item !== q).slice(0, 3)
      );

      const choices = shuffle([...distractors, q]);

      const container = document.getElementById("options");
      container.innerHTML = "";

      choices.forEach((choice) => {
        const btn = document.createElement("button");
        btn.innerText = choice.Chinese;
        btn.onclick = () => handleChoice(btn, choice);
        container.appendChild(btn);
      });
    }

    function handleChoice(button, choice) {
      const correctAnswer = questionSet[currentIndex].Chinese;
      attempts++;

      if (choice.Chinese === correctAnswer) {
        button.classList.add("correct");
        document.querySelectorAll(".options button").forEach(btn => btn.disabled = true);
        if (currentIndex === 0 && !document.getElementById("result-title").innerText) {
          document.getElementById("result-title").innerText = `${window.username} çš„æŒ‘æˆ°çµæœï¼š`;
        }
        document.getElementById("results").innerHTML += 
          (attempts === 1
            ? `<li>âœ… ${questionSet[currentIndex].Vocabulary} â€” ${questionSet[currentIndex].Chinese} â€” ${attempts} æ¬¡ â€” +5åˆ†</li>`
            : `<li style="color: #d39e00;">ğŸŸ¡ ${questionSet[currentIndex].Vocabulary} â€” ${questionSet[currentIndex].Chinese} â€” ${attempts} æ¬¡ â€” 0åˆ†</li>`);
        
        if (attempts === 1) {
          score += 5;
        }
        updateScoreDisplay();

        setTimeout(() => {
          currentIndex++;
          if (currentIndex < questionSet.length && wrongCount < 3) {
            renderQuestion();
          } else {
            endGame();
          }
        }, 800);
      } else {
        button.classList.add("incorrect");
        button.disabled = true;
        wrongCount++;
        if (wrongCount >= 3) {
          setTimeout(() => {
            endGame();
          }, 800);
        }
      }
    }

    function startQuiz() {
      const name = document.getElementById("username").value.trim();
      if (!name) {
        alert("è«‹è¼¸å…¥åå­—å†é–‹å§‹æŒ‘æˆ°ï¼");
        return;
      }
      
      const startButton = document.querySelector("button[onclick='startQuiz()']");
      startButton.innerHTML = "ğŸ”Š é‡è½ç™¼éŸ³";
      startButton.onclick = function() {
        speakCurrentWord();
      };
      
      document.getElementById("username").style.display = "none";
      document.querySelector("label[for='username']").style.display = "none";
      
      document.getElementById("progress-section").style.display = "block";
      document.querySelector(".quiz").style.display = "block";
      window.username = name;
      renderQuestion();
    }

    function speakCurrentWord() {
      const currentWord = questionSet[currentIndex].Vocabulary;
      speechSynthesis.cancel();
      if (!selectedVoice) selectedVoice = findEnglishVoice();
      const utterance = new SpeechSynthesisUtterance(currentWord);
      utterance.voice = selectedVoice;
      utterance.lang = "en-US";
      utterance.rate = 0.9;
      speechSynthesis.speak(utterance);
    }

    document.addEventListener("keydown", function(event) {
      if (event.key === "Enter") {
        const input = document.getElementById("username");
        if (input && input.style.display !== "none") {
          startQuiz();
        }
      }
    });

    document.getElementById("dataset").addEventListener("change", async function(e) {
      const file = e.target.value;
      try {
        const res = await fetch(file);
        if (!res.ok) {
          throw new Error(`HTTP éŒ¯èª¤ï¼Œç‹€æ…‹ç¢¼ï¼š${res.status}`);
        }
        data = await res.json();
        questionSet = shuffle([...data]);
        currentIndex = 0;
        wrongCount = 0;
        score = 0;
        updateProgressBar();
        updateScoreDisplay();
        if (document.querySelector(".quiz").style.display === "block") {
          document.getElementById("results").innerHTML = "";
          document.getElementById("result-title").innerText = "";
          renderQuestion();
        }
      } catch (err) {
        alert("è¼‰å…¥é¡Œåº«å¤±æ•—ï¼Œå°‡ä½¿ç”¨é è¨­é¡Œåº«ã€‚");
        data = [...defaultData];
        questionSet = shuffle([...data]);
        currentIndex = 0;
        wrongCount = 0;
        score = 0;
        updateProgressBar();
        updateScoreDisplay();
        if (document.querySelector(".quiz").style.display === "block") {
          document.getElementById("results").innerHTML = "";
          document.getElementById("result-title").innerText = "";
          renderQuestion();
        }
      }
    });

    (async () => {
      const file = document.getElementById("dataset").value;
      try {
        const res = await fetch(file);
        if (!res.ok) {
          throw new Error(`HTTP éŒ¯èª¤ï¼Œç‹€æ…‹ç¢¼ï¼š${res.status}`);
        }
        data = await res.json();
      } catch (err) {
        data = [...defaultData];
      }
      questionSet = shuffle([...data]);
      currentIndex = 0;
      wrongCount = 0;
      score = 0;
      updateProgressBar();
      updateScoreDisplay();
    })();
  </script>

  <div style="margin-top: 60px; font-size: 0.9em; color: #aaa; text-align: center;">
    Made by Evelyn YT ï½œÂ© 2025 | 2025/4/27 11:28
  </div>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'932df55bc8346763',t:'MTc0NTA4MjAyOS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
